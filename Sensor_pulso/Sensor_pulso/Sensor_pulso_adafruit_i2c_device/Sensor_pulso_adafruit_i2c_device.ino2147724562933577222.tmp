#include <Adafruit_I2CDevice.h>
#include <AsyncTimer.h>

//Dirección I2C del sensor de pulso.
#define PULSE_SENSOR_ADDR 0xAE

//Declaración de funciones del programa
void configuracion_pulse_sensor_incial(Adafruit_I2CDevice i2c_dev);

//Declaración de variables globales
 Adafruit_I2CDevice i2c_pulse_sensor = Adafruit_I2CDevice(PULSE_SENSOR_ADDR);
 AsyncTimer timer;

//Se definen los registros a los que se va a acceder:
#define MODE_CONFIGURATION 0x09
#define SP02_CONFIGURATION 0x0A
#define MODE_CONFIGURATION 0x09
#define MODE_CONFIGURATION 0x09

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);

  Serial.println("I2C device read and write test");

  while(!i2c_pulse_sensor.begin()){
    Serial.print(".");
    delay(100);
  }
  Serial.println("Device found at address 0x"):
  Serial.print(i2c_pulse_sensor.address(), HEX);

  configuracion_pulse_sensor_inicial(i2c_pulse_sensor);
}

void loop() {
  // put your main code here, to run repeatedly:

}

void configuracion_pulse_sensor_incial( Adafruit_I2CDevice i2c_dev ){
  //Para la escritura en los registros había que hacer lo siguiente:
  //Escribir dirección del registro. Escribir dato del registro.
  uint8_t buffer[2];
  //i2c_pulse_sensor.setSpeed(400000);
  buffer[0] = MODE_CONFIGURATION;
  buffer[1] = 0x02;
  i2c_dev.write(buffer,2,True);
}
